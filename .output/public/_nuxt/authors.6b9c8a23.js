import z from"./menubar.esm.0eb4abc5.js";import G from"./inputnumber.esm.ac77af66.js";import L from"./column.esm.2eb3cecb.js";import O from"./inputtext.esm.6f13cc8a.js";import P from"./button.esm.4cfb2234.js";import R from"./datatable.esm.8de18a27.js";import j from"./toast.esm.f4f4a740.js";import J from"./confirmdialog.esm.35d539de.js";import Q from"./dynamicdialog.esm.c255c087.js";import{g as W,r as c,A as H,B as X,C as Y,D as Z,c as ee,b as o,u as i,w as p,z as oe,E as w,o as re,G as $}from"./entry.e65a8b12.js";import{u as te}from"./fetch.67514f53.js";import{s as f}from"./index.ca906294.js";import{_ as ae}from"./NewAuthor.vue.44b81c2c.js";import"./index.esm.92dc1bc2.js";import"./baseicon.esm.727e0a4e.js";import"./index.esm.4ca4af39.js";import"./index.esm.6ffad009.js";import"./index.esm.08a63c45.js";import"./badge.esm.63629650.js";import"./index.esm.2a477ad8.js";import"./paginator.esm.1b688027.js";import"./index.esm.b3e830a1.js";import"./dropdown.esm.1ffad83e.js";import"./index.esm.f6d9606f.js";import"./index.esm.42b2c471.js";import"./overlayeventbus.esm.5f1005ca.js";import"./portal.esm.aa40dffd.js";import"./virtualscroller.esm.5359c919.js";import"./index.esm.ba2c5980.js";import"./index.esm.4b125a15.js";import"./index.esm.cd5b4d12.js";import"./index.esm.0501af64.js";import"./index.esm.20c9b6e4.js";import"./index.esm.6f348039.js";import"./dialog.esm.99eb5595.js";import"./tag.esm.ba7bd9e1.js";import"./chips.esm.d05f38cf.js";const ie={class:"h:full flex flex:column"},Re=W({__name:"authors",setup(se){const s=[{field:"id",order:-1}],_=c({id:{value:null,matchMode:w.EQUALS},name:{value:null,matchMode:w.CONTAINS}}),{t:r}=H(),D=X(),l=Y(),x=Z(),h=c(!1),t=c({offset:0,limit:20,order_by:f(s)}),C=c([{label:"添加条目",icon:"pi pi-plus",command:M},{label:"刷新",icon:"pi pi-refresh",command:()=>m()}]),{data:y,pending:k,error:le,execute:m}=te("/api/authors/item",{query:t,server:!1},"$K5iJBgiekx");function E(e){D.require({message:"你是否确定要删除？",header:"确认删除",icon:"pi pi-info-circle",acceptClass:"p-button-danger p-button-text",rejectClass:"p-button",accept:()=>{h.value=!0,$fetch.raw(`/api/authors/item/${e}`,{method:"DELETE",ignoreResponseError:!0}).then(d=>{switch(d.status){case 200:m(),l.add({severity:"info",summary:r("shared.confirmed"),detail:r("messages.itemDeleted"),life:3e3});break;case 403:l.add({severity:"error",summary:r("shared.error"),detail:r("requestErrors.status.403"),life:3e3});break;case 404:l.add({severity:"error",summary:r("shared.error"),detail:r("requestErrors.status.404"),life:3e3});break;default:l.add({severity:"error",summary:r("shared.error"),detail:r("requestErrors.status.404"),life:3e3});break}}).catch(()=>{l.add({severity:"error",summary:r("shared.error"),detail:r("requestErrors.network"),life:3e3})}).finally(()=>{h.value=!1})}})}function I(e){t.value={...t.value,offset:e.first,order_by:f(e.multiSortMeta??s),id:e.filters.id.value??void 0,name:e.filters.name.value?`%${e.filters.name.value}%`:void 0},m()}function V(e){t.value={...t.value,offset:e.first,order_by:f(e.multiSortMeta??s),id:e.filters.id.value??void 0,name:e.filters.name.value?`%${e.filters.name.value}%`:void 0},m()}function q(e){t.value={...t.value,offset:e.first,order_by:f(e.multiSortMeta??s),id:e.filters.id.value??void 0,name:e.filters.name.value?`%${e.filters.name.value}%`:void 0}}function M(){x.open(ae,{props:{header:"添加作者",modal:!0,style:{width:"50rem",maxWidth:"100vw"}},onClose:e=>{(e==null?void 0:e.type)==="config-close"&&m()}})}return(e,d)=>{var g,b;const T=z,B=G,v=L,F=O,K=P,S=R,U=j,N=J,A=Q;return re(),ee("div",ie,[o(T,{model:i(C),pt:{root:{class:"border:none"}}},null,8,["model"]),o(S,{value:((g=i(y))==null?void 0:g.items)??[],first:i(t).offset,rows:i(t).limit,loading:i(k),"total-records":((b=i(y))==null?void 0:b.count)??0,"sort-mode":"multiple","multi-sort-meta":s,filters:i(_),"onUpdate:filters":d[0]||(d[0]=a=>oe(_)?_.value=a:null),globalFilterFields:["id","name"],filterDisplay:"menu","data-key":"id",lazy:"",paginator:"",onPage:I,onSort:V,onFilter:q,class:"flex-grow:1"},{default:p(()=>[o(v,{field:"id",header:"ID","show-filter-match-modes":!1,sortable:""},{filter:p(({filterModel:a,filterCallback:u})=>[o(B,{modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,onKeydown:$(n=>u(),["enter"]),useGrouping:!1,class:"p-column-filter",placeholder:"检索ID"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(v,{field:"name",header:"作者名","show-filter-match-modes":!1,sortable:""},{filter:p(({filterModel:a,filterCallback:u})=>[o(F,{modelValue:a.value,"onUpdate:modelValue":n=>a.value=n,onKeydown:$(n=>u(),["enter"]),class:"p-column-filter",placeholder:"检索作者名"},null,8,["modelValue","onUpdate:modelValue","onKeydown"])]),_:1}),o(v,{header:"操作"},{body:p(a=>[o(K,{onClick:u=>E(a.data.id),icon:"pi pi-trash",size:"small",severity:"danger",loading:i(h),text:""},null,8,["onClick","loading"])]),_:1})]),_:1},8,["value","first","rows","loading","total-records","filters"]),o(U),o(N),o(A)])}}});export{Re as default};
